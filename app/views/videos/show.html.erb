<div class="wrapper scroll">
  <div class="offCanvasMask"></div>
  <aside class="leftPanel">
    <div>
       <button type="button" class="offCanvasBtn offCanvasBtnStyle hideOnDesktop">
      <span class="offCanvasBar">&nbsp;</span>
      <span class="offCanvasBar">&nbsp;</span>
      <span class="offCanvasBar">&nbsp;</span>
    </button>

    <%= link_to "flickbin", root_path, class: "brand" %>
    <% if current_user.present? %>
      <div class="clearfix hideOnDesktop mobileBtnPosition">
        <%= render 'partials/logged_in_right_header' %>
      </div>
    <% else %>
      <div class="clearfix btnGroup hideOnDesktop mobileBtnPosition">
        <%= render 'partials/right_header' %>
      </div>
    <% end %>

    <%= render 'partials/trending_tags_bar' %>
    </div>

  </aside>

  <section class="videoContentPanel comments">
    <section class="videoTop">
      <div class="clearfix bottom-margin-15">
        <% if current_user.present? %>
          <div class="upDownOptions clearfix" voted="<%= @vote&.value %>" channelSlug="<%= @video_owner.slug %>">
            <span class="counterOption upVote <%= 'voted' if @vote&.value&.positive? %>"><i class="fas fa-caret-up"></i></span>
            <span class="counterNumber counterValueHolder"><%= @video.votes_amount %></span>
            <span class="counterOption downVote <%= 'voted' if @vote&.value&.negative? %>"><i class="fas fa-caret-down"></i></span>
          </div>

          <div class="afterLoginBtns reverseThemeHoler afterLoginReverseBtn fRight hideOnMobile">
            <%= render 'partials/logged_in_right_header' %>
          </div>
        <% else %>
          <div class="upDownOptions clearfix" channelSlug="<%= @video_owner.slug %>">
            <span class="counterOption upVote" loginRequired='true'><i class="fas fa-caret-up"></i></span>
            <span class="counterNumber counterValueHolder"><%= @video.votes_amount %></span>
            <span class="counterOption downVote" loginRequired='true'><i class="fas fa-caret-down"></i></span>
          </div>

          <div class="clearfix btnGroup btnReverseTheme fRight hideOnMobile">
            <%= render 'partials/right_header' %>
          </div>
        <% end %>

        <div class="videoTopDesc" videoSlug="<%= @video.slug %>">
          <div class="videoTopDescCell"><%= @video.title %></div>
        </div>
      </div>
      <div class="videoViewManager">
        <div class='embed-container'>
          <iframe src="https://www.youtube.com/embed/<%= @video.youtube_id %>?autoplay=1" frameborder='0' allow="autoplay" allowfullscreen></iframe>
          </div>
      </div>
    </section>
    <div class="underneathPlayer clearfix">
      <span>
        #<%= @video.rank %> in <%= link_to @tag.title, tag_path(@tag) %>
      </span>
      <span>submitted by <%= link_to @video_owner.channel_name, station_path(@video_owner) %></span>
    </div>

    <div class="commentSection" current_user_id="<%= current_user&.id %>">
      <h4 class="commentTitle">How does this video make you feel?</h4>
      <div class="labelFields vidioFieldOuter">
        <% if current_user.present? %>
          <%= text_field_tag :message, nil, placeholder: 'Enter comment', class: "block noInsideLabel" %>
        <% else %>
          <%= text_field_tag :message, nil, placeholder: 'Enter comment', loginRequired: true, class: "block noInsideLabel" %>
        <% end %>
      </div>

      <div class="comments-feed">
        <% if @comments_tree.present? %>
          <% @comments_tree.each do |root_comment_node|%>
            <% root_comment_node.each do |root_comment, child_comments| %>
              <div class="commentEntity <%='hasNestedComment' if child_comments.present? %>" comment_id="<%= root_comment.id %>">
                <%= link_to station_path(root_comment.commentator), class: 'commentorThumb' do %>
                  <%= image_tag(root_comment.commentator.avatar.thumb_44x44.url || '/images/avatar_holder.jpg') %>
                <% end %>
                <div class="commentorLine clearfix">
                  <%= link_to root_comment.commentator.channel_name, station_path(root_comment.commentator) %>
                  <span>&bull;</span>
                  <small><%= "#{time_ago_in_words(root_comment.created_at)} ago" %></small>
                </div>
                <p><%= root_comment.message %></p>
                <% if current_user.present? && current_user.id != root_comment.commentator.id %>
                  <div class="commentReplyOption">
                    <a href="#" class="replyComment">Reply</a>
                  </div>
                <% end %>
              </div>
              <% if child_comments.present? %>
                <% child_comments.each do |child_comment, grand_child| %>
                  <div class="commentEntity" comment_id="<%= child_comment.id %>">
                    <div class="nestedComment nestedCommented">
                      <%= link_to station_path(child_comment.commentator), class: 'commentorThumb' do %>
                        <%= image_tag(child_comment.commentator.avatar.thumb_44x44.url || '/images/avatar_holder.jpg') %>
                      <% end %>
                      <div class="commentorLine clearfix">
                        <%= link_to child_comment.commentator.channel_name, station_path(child_comment.commentator) %>
                        <span>&bull;</span>
                        <small><%= "#{time_ago_in_words(child_comment.created_at)} ago" %></small>
                      </div>
                      <p><%= child_comment.message %></p>
                    </div>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
  </section>
</div>

<%= javascript_include_tag('specific_by_templates/specific_video') %>
